# Nuxt Request Timeline

[![npm version][npm-version-src]][npm-version-href]
[![npm downloads][npm-downloads-src]][npm-downloads-href]
[![License][license-src]][license-href]
[![Nuxt][nuxt-src]][nuxt-href]

Nuxt module to record the execution time of different parts of the SSR request in order to analyze it using a [waterfall chart](https://developers.google.com/chart/interactive/docs/gallery/timeline).

- [✨ &nbsp;Release Notes](/CHANGELOG.md)
  <!-- - [🏀 Online playground](https://stackblitz.com/github/your-org/nuxt-request-timeline?file=playground%2Fapp.vue) -->
  <!-- - [📖 &nbsp;Documentation](https://example.com) -->

## Setup

Install the module to your Nuxt application with one command:

```bash
npx nuxi module add nuxt-request-timeline
```

or add it manually to your nuxt config:

```ts
export default defineNuxtConfig({
  modules: ['nuxt-request-timeline'],
  requestTimeline: {
    /* options */
  },
})
```

## How to use

By default, `nuxt-request-timeline` only records the start and end times of the server request. You have to manually call the `start` and `end` methods to record specific chunks:

### Record a specific part of the request:

```ts
const timeline = useRequestTimeline()

// The id doesn't have to be unique if you use the
// returned function to end the execution
const end = timeline.start('some-id')
await someQuery()
end()
```

### Analyze the timeline

The SSR request timeline url will be generated and logged in the browser console before the client-side hydration. Look for `Request timeline available at: URL` then click on the link to open the `/timeline` route and look at the chart.

<img width="934" alt="Screenshot 2024-06-24 at 16 08 07" src="https://github.com/pmrotule/nuxt-request-timeline/assets/10983258/e04dad39-691f-42d5-9a5d-172e92729c4a">

#### Generate the url on demand

The client-side urls are not being generated automatically, but can be generated by running the following command in the browser console:

```js
__NUXT_REQUEST_TIMELINE.generateUrl()
```

## Module Options

### `isEnabled`

| Type      | Default                                 |
| --------- | --------------------------------------- |
| `boolean` | `process.env.NODE_ENV !== 'production'` |

Define if the module should be enabled which means injecting the plugin to add the RequestTimeline instance to the `nuxtApp` and adding the timeline route. Since the timeline might not be present in the context, you need to use optional chaining when calling `start` like in the code snippet in [#How to use](#how-to-use).

## Contribution

<details>
  <summary>Local development</summary>
  
  ```bash
  # Install dependencies
  pnpm install
  
  # Generate type stubs
  pnpm run dev:prepare
  
  # Develop with the playground
  pnpm run dev
  
  # Build the playground
  pnpm run dev:build
  
  # Run ESLint
  pnpm run lint
  
  # Run Vitest
  pnpm run test
  pnpm run test:watch
  
  # Release new version
  pnpm run release
  ```

</details>

<!-- Badges -->

[npm-version-src]: https://img.shields.io/npm/v/nuxt-request-timeline/latest.svg?style=flat&colorA=020420&colorB=00DC82
[npm-version-href]: https://npmjs.com/package/nuxt-request-timeline
[npm-downloads-src]: https://img.shields.io/npm/dm/nuxt-request-timeline.svg?style=flat&colorA=020420&colorB=00DC82
[npm-downloads-href]: https://npmjs.com/package/nuxt-request-timeline
[license-src]: https://img.shields.io/npm/l/nuxt-request-timeline.svg?style=flat&colorA=020420&colorB=00DC82
[license-href]: https://npmjs.com/package/nuxt-request-timeline
[nuxt-src]: https://img.shields.io/badge/Nuxt-020420?logo=nuxt.js
[nuxt-href]: https://nuxt.com
